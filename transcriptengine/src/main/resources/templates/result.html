<!DOCTYPE html>
<html>
<head>
    <title>Search Results</title>
</head>
<body>
<h1>Search Results</h1>
<div th:if="${response}">
    <table border="1">
        <thead>
        <tr>
            <th>Link URL</th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="clickRequest : ${response}">
            <td class="link" onclick="recordLinkClick(event)">
                <a th:href="${clickRequest.linkUrl}" th:text="${clickRequest.linkUrl}">Link</a>
            </td>
            <td>
                <div class="thumbs">
                    <button class="thumbs-up" onclick="thumbsUp(event)">👍</button>
                </div>
            </td>
            <td>
                <div class="thumbs">
                    <button class="thumbs-down" onclick="thumbsDown(event)">👎</button>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<div th:unless="${response}">
    <p>No results found.</p>
</div>

<!-- JavaScript functions for thumbs up and thumbs down actions -->
<script>
    function recordLinkClick(event) {
        var linkElement = event.currentTarget;
        var linkUrl = linkElement.closest('tr').querySelector('.link').innerText.trim();
        console.log('Link clicked:', linkUrl);
        /* Get the user ID */;
        // Implement a way to get the user ID
        const userId = 123;

        fetch('/record-click', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                userId: userId,
                linkUrl: linkUrl,
            }),
        })
        .then(response => {
            if (response.ok) {
                console.log(`Click recorded for link: ${linkUrl}`);
            } else {
                console.error('Failed to record click.');
            }
        })
        .catch(error => {
            console.error('Error recording click:', error);
        });
    }

    function thumbsUp(event) {
        const thumbsUpLinkElement = event.currentTarget;
        const thumbsUpUrl = thumbsUpLinkElement.closest('tr').querySelector('.link').innerText.trim();
        console.log('Thumbs up for the link:', thumbsUpUrl);
        /* Get the user ID */;
        // Implement a way to get the user ID
        const userId = 123;

        fetch('/record-thumbsUp', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                userId: userId,
                linkUrl: thumbsUpUrl,
            }),
        })
        .then(response => {
            if (response.ok) {
                console.log(`Thumbs up recorded for link: ${thumbsUpUrl}`);
            } else {
                console.error('Failed to record thumbs up.');
            }
        })
        .catch(error => {
            console.error('Error recording thumbs up:', error);
        });
    }

    function thumbsDown(event) {
        const thumbsDownLinkElement = event.currentTarget;
        const thumbsDownUrl = thumbsDownLinkElement.closest('tr').querySelector('.link').innerText.trim();
        console.log('Thumbs down for the link:', thumbsDownUrl);
        /* Get the user ID */;
        // Implement a way to get the user ID
        const userId = 123;

        fetch('/record-thumbsDown', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                userId: userId,
                linkUrl: thumbsDownUrl,
            }),
        })
        .then(response => {
            if (response.ok) {
                console.log(`Thumbs down recorded for link: ${thumbsDownUrl}`);
            } else {
                console.error('Failed to record thumbs down.');
            }
        })
        .catch(error => {
            console.error('Error recording thumbs down:', error);
        });
    }
</script>
</body>
</html>
